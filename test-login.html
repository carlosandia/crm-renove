<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß™ Teste de Debug - CRM Renove</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8fafc;
      color: #1f2937;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #1f2937;
      text-align: center;
      margin-bottom: 30px;
    }
    .test-section {
      background-color: #f3f4f6;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    button {
      background-color: #3b82f6;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #2563eb;
    }
    button.danger {
      background-color: #ef4444;
    }
    button.danger:hover {
      background-color: #dc2626;
    }
    button.success {
      background-color: #10b981;
    }
    button.success:hover {
      background-color: #059669;
    }
    .log {
      background-color: #1f2937;
      color: #f9fafb;
      padding: 15px;
      border-radius: 6px;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.5;
    }
    .success {
      color: #10b981;
    }
    .error {
      color: #ef4444;
    }
    .warning {
      color: #f59e0b;
    }
    .info {
      color: #3b82f6;
    }
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .status-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    .status-card.online {
      border-color: #10b981;
      background-color: #ecfdf5;
    }
    .status-card.offline {
      border-color: #ef4444;
      background-color: #fef2f2;
    }
    .status-card.unknown {
      border-color: #f59e0b;
      background-color: #fffbeb;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Teste de Debug - CRM Renove</h1>
    
    <div class="test-section">
      <h2>üîç Status dos Servi√ßos</h2>
      <div class="status-grid">
        <div class="status-card unknown" id="frontend-status">
          <h3>Frontend (8080)</h3>
          <p id="frontend-text">Verificando...</p>
        </div>
        <div class="status-card unknown" id="backend-status">
          <h3>Backend (3001)</h3>
          <p id="backend-text">Verificando...</p>
        </div>
        <div class="status-card unknown" id="main-status">
          <h3>Main React App</h3>
          <p id="main-text">Verificando...</p>
        </div>
        <div class="status-card unknown" id="cache-status">
          <h3>Cache Status</h3>
          <p id="cache-text">Verificando...</p>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>üß™ Testes de Conectividade</h2>
      <button onclick="testServices()">üîç Verificar Servi√ßos</button>
      <button onclick="testReact()">‚öõÔ∏è Testar React App</button>
      <button onclick="testLogin()">üîë Testar Login</button>
      <button onclick="clearCache()" class="danger">üßπ Limpar Cache</button>
      <button onclick="goToMain()" class="success">‚û°Ô∏è Ir para CRM</button>
    </div>

    <div class="test-section">
      <h2>üìã Log de Atividades</h2>
      <div id="log" class="log"></div>
    </div>
  </div>

  <script>
    const log = (message, type = 'info') => {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = type;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    };

    const updateStatus = (service, status, message) => {
      const card = document.getElementById(`${service}-status`);
      const text = document.getElementById(`${service}-text`);
      
      card.className = `status-card ${status}`;
      text.textContent = message;
      
      const statusEmoji = {
        'online': '‚úÖ',
        'offline': '‚ùå',
        'unknown': '‚ö†Ô∏è'
      };
      
      log(`${statusEmoji[status]} ${service}: ${message}`, status === 'online' ? 'success' : status === 'offline' ? 'error' : 'warning');
    };

    async function testServices() {
      log('üîç Iniciando verifica√ß√£o de servi√ßos...', 'info');
      
      // Teste Frontend
      try {
        const frontendResponse = await fetch('http://127.0.0.1:8080/', {
          method: 'GET',
          cache: 'no-cache'
        });
        
        if (frontendResponse.ok) {
          const html = await frontendResponse.text();
          if (html.includes('root') && html.includes('main.tsx')) {
            updateStatus('frontend', 'online', 'Servindo HTML + React');
          } else {
            updateStatus('frontend', 'offline', 'HTML sem React');
          }
        } else {
          updateStatus('frontend', 'offline', `HTTP ${frontendResponse.status}`);
        }
      } catch (error) {
        updateStatus('frontend', 'offline', 'Conex√£o falhou');
      }
      
      // Teste Backend
      try {
        const backendResponse = await fetch('http://127.0.0.1:3001/health', {
          method: 'GET',
          cache: 'no-cache'
        });
        
        if (backendResponse.ok) {
          updateStatus('backend', 'online', 'API respondendo');
        } else {
          updateStatus('backend', 'offline', `HTTP ${backendResponse.status}`);
        }
      } catch (error) {
        updateStatus('backend', 'offline', 'Conex√£o falhou');
      }
      
      // Teste Main.tsx
      try {
        const mainResponse = await fetch('http://127.0.0.1:8080/src/main.tsx', {
          method: 'GET',
          cache: 'no-cache'
        });
        
        if (mainResponse.ok) {
          const mainCode = await mainResponse.text();
          if (mainCode.includes('LoginForm') && mainCode.includes('ReactDOM')) {
            updateStatus('main', 'online', 'React carregando');
          } else {
            updateStatus('main', 'offline', 'React incompleto');
          }
        } else {
          updateStatus('main', 'offline', `HTTP ${mainResponse.status}`);
        }
      } catch (error) {
        updateStatus('main', 'offline', 'N√£o carregou');
      }
      
      // Teste Cache
      const hasCache = localStorage.length > 0 || sessionStorage.length > 0;
      const cacheCount = localStorage.length + sessionStorage.length;
      
      if (hasCache) {
        updateStatus('cache', 'unknown', `${cacheCount} itens no cache`);
      } else {
        updateStatus('cache', 'online', 'Cache limpo');
      }
      
      log('‚úÖ Verifica√ß√£o de servi√ßos conclu√≠da', 'success');
    }

    async function testReact() {
      log('‚öõÔ∏è Testando renderiza√ß√£o do React...', 'info');
      
      try {
        // Verificar se h√° elemento root
        const rootResponse = await fetch('http://127.0.0.1:8080/', {
          method: 'GET',
          cache: 'no-cache'
        });
        
        const html = await rootResponse.text();
        
        if (html.includes('id="root"')) {
          log('‚úÖ Elemento root encontrado no HTML', 'success');
        } else {
          log('‚ùå Elemento root n√£o encontrado', 'error');
        }
        
        if (html.includes('src="/src/main.tsx"')) {
          log('‚úÖ Script main.tsx referenciado', 'success');
        } else {
          log('‚ùå Script main.tsx n√£o referenciado', 'error');
        }
        
        // Verificar se console.log est√° executando
        log('üîç Verificando logs do console...', 'info');
        log('‚ÑπÔ∏è Abra o DevTools (F12) para ver logs do React', 'info');
        
      } catch (error) {
        log('‚ùå Erro ao testar React: ' + error.message, 'error');
      }
    }

    async function testLogin() {
      log('üîë Testando login...', 'info');
      
      try {
        const response = await fetch('http://127.0.0.1:3001/api/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: 'seraquevai@seraquevai.com',
            password: '123456'
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          log(`‚úÖ Login bem-sucedido! Role: ${data.user.role}`, 'success');
        } else {
          const error = await response.json();
          log(`‚ùå Login falhou: ${error.message}`, 'error');
        }
      } catch (error) {
        log('‚ùå Erro no login: ' + error.message, 'error');
      }
    }

    function clearCache() {
      log('üßπ Limpando cache...', 'info');
      
      // Limpar localStorage
      const localCount = localStorage.length;
      localStorage.clear();
      log(`‚úÖ ${localCount} itens removidos do localStorage`, 'success');
      
      // Limpar sessionStorage
      const sessionCount = sessionStorage.length;
      sessionStorage.clear();
      log(`‚úÖ ${sessionCount} itens removidos do sessionStorage`, 'success');
      
      // Limpar Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          registrations.forEach(registration => {
            registration.unregister();
            log('‚úÖ Service Worker removido', 'success');
          });
        });
      }
      
      // Limpar cache das APIs
      if ('caches' in window) {
        caches.keys().then(cacheNames => {
          cacheNames.forEach(cacheName => {
            caches.delete(cacheName);
            log(`‚úÖ Cache removido: ${cacheName}`, 'success');
          });
        });
      }
      
      updateStatus('cache', 'online', 'Cache limpo');
      log('‚ú® Cache limpo com sucesso!', 'success');
    }

    function goToMain() {
      log('‚û°Ô∏è Redirecionando para CRM...', 'info');
      window.location.href = 'http://127.0.0.1:8080/';
    }

    // Executar testes automaticamente quando carregar
    window.onload = function() {
      log('üìã P√°gina de debug carregada', 'info');
      log('üåê User Agent: ' + navigator.userAgent, 'info');
      
      // Verificar servi√ßos automaticamente
      setTimeout(testServices, 1000);
    };
  </script>
</body>
</html>