<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste da Correção de Warnings</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { border: 1px solid #ccc; padding: 20px; margin: 10px 0; }
        .warning { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 5px; }
        #console-output { 
            background: #f0f0f0; 
            padding: 10px; 
            margin: 10px 0; 
            border: 1px solid #ccc; 
            height: 200px; 
            overflow-y: scroll; 
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>🧪 Teste da Correção de Warnings Repetitivos - CompanyList</h1>
    
    <div class="test-container">
        <h2>Simulação da Função getIndustryDisplay Corrigida</h2>
        <p>Este teste simula o comportamento da função <code>getIndustryDisplay</code> corrigida no <code>CompanyList.tsx</code>:</p>
        
        <button onclick="testSingleWarning()">Teste 1: Uma empresa sem nicho (deve alertar 1x)</button>
        <button onclick="testMultipleCallsSameCompany()">Teste 2: Múltiplas chamadas mesma empresa (deve alertar 1x)</button>
        <button onclick="testDifferentCompanies()">Teste 3: Empresas diferentes (deve alertar para cada)</button>
        <button onclick="testIndustryFixed()">Teste 4: Empresa corrigida (deve limpar cache)</button>
        <button onclick="clearConsole()">Limpar Console</button>
        
        <div id="console-output"></div>
    </div>

    <script>
        // ✅ SIMULAÇÃO: Implementação da correção realizada no CompanyList.tsx
        const warnedCompanies = new Set(); // Simula useRef<Set<string>>(new Set())
        
        // Função que simula a getIndustryDisplay corrigida
        function getIndustryDisplay(company) {
            if (!company.industry || company.industry.trim() === '') {
                // ✅ CORREÇÃO: Log apenas uma vez por empresa para evitar spam no console
                if (!warnedCompanies.has(company.id)) {
                    console.warn(`[CompanyList] Empresa "${company.name}" sem nicho definido`);
                    logToOutput(`⚠️ WARNING: [CompanyList] Empresa "${company.name}" sem nicho definido`);
                    warnedCompanies.add(company.id);
                } else {
                    logToOutput(`🔇 SILENCIADO: Warning para empresa "${company.name}" já foi mostrado`);
                }
                return 'Não definido';
            }
            
            // ✅ LIMPEZA: Remover do cache se industry foi corrigido
            if (warnedCompanies.has(company.id)) {
                warnedCompanies.delete(company.id);
                logToOutput(`🧹 CACHE LIMPO: Empresa "${company.name}" teve industry corrigido`);
            }
            
            return company.industry.trim();
        }
        
        // Função auxiliar para log visual
        function logToOutput(message) {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
            warnedCompanies.clear();
            logToOutput('🧽 Console e cache limpos');
        }
        
        // ✅ TESTE 1: Uma empresa sem nicho (deve alertar apenas 1x)
        function testSingleWarning() {
            logToOutput('\n🧪 TESTE 1: Uma empresa sem nicho');
            const company = { id: 'test-1', name: 'teste1', industry: '' };
            
            const result = getIndustryDisplay(company);
            logToOutput(`📋 Resultado: "${result}"`);
        }
        
        // ✅ TESTE 2: Múltiplas chamadas para a mesma empresa (deve alertar apenas 1x)
        function testMultipleCallsSameCompany() {
            logToOutput('\n🧪 TESTE 2: Múltiplas chamadas mesma empresa');
            const company = { id: 'test-2', name: 'teste2', industry: null };
            
            // Simular múltiplas renderizações do mesmo componente (o problema original)
            for (let i = 1; i <= 5; i++) {
                logToOutput(`🔄 Chamada ${i}:`);
                const result = getIndustryDisplay(company);
                logToOutput(`   📋 Resultado: "${result}"`);
            }
        }
        
        // ✅ TESTE 3: Empresas diferentes (deve alertar para cada uma)
        function testDifferentCompanies() {
            logToOutput('\n🧪 TESTE 3: Empresas diferentes');
            const companies = [
                { id: 'test-3a', name: 'EmpresaA', industry: '' },
                { id: 'test-3b', name: 'EmpresaB', industry: null },
                { id: 'test-3c', name: 'EmpresaC', industry: '   ' }
            ];
            
            companies.forEach((company, index) => {
                logToOutput(`🔄 Testando empresa ${index + 1}:`);
                const result = getIndustryDisplay(company);
                logToOutput(`   📋 Resultado: "${result}"`);
            });
        }
        
        // ✅ TESTE 4: Empresa com industry corrigido (deve limpar cache)
        function testIndustryFixed() {
            logToOutput('\n🧪 TESTE 4: Empresa corrigida');
            
            // Primeiro: empresa sem industry (gera warning)
            let company = { id: 'test-4', name: 'teste4', industry: '' };
            logToOutput('🔄 Primeira chamada (sem industry):');
            let result = getIndustryDisplay(company);
            logToOutput(`   📋 Resultado: "${result}"`);
            
            // Segundo: mesma empresa, ainda sem industry (não deve alertar novamente)
            logToOutput('🔄 Segunda chamada (ainda sem industry):');
            result = getIndustryDisplay(company);
            logToOutput(`   📋 Resultado: "${result}"`);
            
            // Terceiro: empresa corrigida com industry (deve limpar cache)
            company = { id: 'test-4', name: 'teste4', industry: 'Tecnologia' };
            logToOutput('🔄 Terceira chamada (industry corrigido):');
            result = getIndustryDisplay(company);
            logToOutput(`   📋 Resultado: "${result}"`);
            
            // Quarto: empresa volta a ficar sem industry (deve alertar novamente)
            company = { id: 'test-4', name: 'teste4', industry: '' };
            logToOutput('🔄 Quarta chamada (sem industry novamente):');
            result = getIndustryDisplay(company);
            logToOutput(`   📋 Resultado: "${result}"`);
        }
        
        // Inicializar página
        logToOutput('✅ Sistema de teste carregado - CompanyList warning fix');
        logToOutput('📋 Cache de warnings iniciado');
    </script>
</body>
</html>