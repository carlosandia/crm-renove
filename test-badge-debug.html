<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Debug Badge</title>
</head>
<body>
    <h1>🔍 Teste Debug Badge - Sistema de Logs</h1>
    <p><strong>Status:</strong> ✅ Logs implementados com sucesso!</p>
    
    <h2>📋 Logs Implementados:</h2>
    <ul>
        <li>✅ <strong>Frontend (LeadCardPresentation):</strong> Log completo quando badge é clicado</li>
        <li>✅ <strong>Frontend (useCadenceActivityGenerator):</strong> Debug da requisição e resposta</li>
        <li>✅ <strong>Backend (cadence.ts):</strong> Debug completo do endpoint</li>
        <li>✅ <strong>Backend (cadence.ts):</strong> Debug específico do generateCumulativeTaskInstances</li>
    </ul>

    <h2>🎯 Como testar:</h2>
    <ol>
        <li>Acesse o CRM em <a href="http://127.0.0.1:8080" target="_blank">http://127.0.0.1:8080</a></li>
        <li>Abra o Console do navegador (F12)</li>
        <li>Encontre um card com badge "0/0" (como "testecarlos5")</li>
        <li>Clique no badge "0/0"</li>
        <li>Observe os logs no console:</li>
        <ul>
            <li><code>🎯 [DEBUG-BADGE-CARD]</code> - Dados do lead</li>
            <li><code>🔍 [DEBUG-BADGE-FRONTEND]</code> - Requisição sendo enviada</li>
            <li><code>📨 [DEBUG-BADGE-FRONTEND]</code> - Resposta recebida</li>
        </ul>
        <li>Verifique logs do backend na sua sessão terminal</li>
    </ol>

    <h2>🔍 O que procurar nos logs:</h2>
    <ul>
        <li><strong>lead_master_id presente?</strong> Deve aparecer nos logs frontend</li>
        <li><strong>Request chegando no backend?</strong> Logs <code>[DEBUG-BADGE]</code></li>
        <li><strong>generateCumulativeTaskInstances sendo chamado?</strong> Log <code>🚀</code></li>
        <li><strong>Resultado da geração?</strong> Log <code>📊</code></li>
    </ul>

    <h2>💡 Diagnóstico Esperado:</h2>
    <p>Com estes logs, devemos identificar exatamente onde o processo está falhando:</p>
    <ol>
        <li><strong>Se não há logs frontend:</strong> Badge não está sendo clicado ou função não executada</li>
        <li><strong>Se não há logs backend:</strong> Request não está chegando (problema de rede/auth)</li>
        <li><strong>Se logs param em generateCumulativeTaskInstances:</strong> Problema no CadenceService</li>
        <li><strong>Se tudo logado mas sem atividades criadas:</strong> Problema na configuração ou dados</li>
    </ol>

    <hr>
    <p><strong>Status dos serviços:</strong></p>
    <p id="serviceStatus">Verificando...</p>

    <script>
        // Verificar status dos serviços
        async function checkServices() {
            const statusEl = document.getElementById('serviceStatus');
            
            try {
                // Verificar backend
                const backendResponse = await fetch('http://127.0.0.1:3001/health');
                const backendOk = backendResponse.ok;
                
                // Verificar frontend
                const frontendResponse = await fetch('http://127.0.0.1:8080/');
                const frontendOk = frontendResponse.ok;
                
                statusEl.innerHTML = `
                    Backend: ${backendOk ? '✅' : '❌'} (127.0.0.1:3001)<br>
                    Frontend: ${frontendOk ? '✅' : '❌'} (127.0.0.1:8080)<br>
                    <br>
                    ${backendOk && frontendOk ? 
                        '🚀 <strong>Pronto para teste!</strong> Acesse o CRM e clique no badge.' : 
                        '⚠️ Alguns serviços estão offline. Verifique se ambos estão rodando.'
                    }
                `;
            } catch (error) {
                statusEl.innerHTML = `❌ Erro ao verificar serviços: ${error.message}`;
            }
        }
        
        checkServices();
    </script>
</body>
</html>