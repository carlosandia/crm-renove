<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Login Frontend</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Teste Login Frontend Simplificado</h1>
    
    <div>
        <h2>Teste Supabase direto</h2>
        <button onclick="testSupabaseLogin()">Login via Supabase</button>
        <div id="supabase-result"></div>
    </div>
    
    <div>
        <h2>Teste via Frontend</h2>
        <button onclick="testFrontendLogin()">Login via Frontend</button>
        <div id="frontend-result"></div>
    </div>

    <script>
        // Configurar Supabase
        const { createClient } = supabase;
        const supabaseClient = createClient(
            'https://marajvabdwkpgopytvhh.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hcmFqdmFiZHdrcGdvcHl0dmhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NjQwMDksImV4cCI6MjA2NTM0MDAwOX0.C_2W2u8JyApjbhqPJm1q1dFX82KoRSm3auBfE7IpmDU'
        );

        const supabaseResult = document.getElementById('supabase-result');
        const frontendResult = document.getElementById('frontend-result');

        async function testSupabaseLogin() {
            try {
                supabaseResult.innerHTML = 'üîÑ Testando login direto via Supabase...';
                
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: 'seraquevai@seraquevai.com',
                    password: 'abc12345!'
                });

                if (error) {
                    supabaseResult.innerHTML = `‚ùå Erro Supabase: ${error.message}`;
                    return;
                }

                supabaseResult.innerHTML = `‚úÖ Login Supabase OK! User: ${data.user?.email}`;
                
                // Testar backend
                await testBackendWithToken(data.session.access_token);

            } catch (err) {
                supabaseResult.innerHTML = `‚ùå Erro cr√≠tico: ${err.message}`;
            }
        }

        async function testBackendWithToken(token) {
            try {
                const response = await fetch('http://127.0.0.1:3001/api/pipelines', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                
                if (response.ok) {
                    supabaseResult.innerHTML += `<br>‚úÖ Backend OK! Pipelines: ${result.pipelines?.length || 0}`;
                } else {
                    supabaseResult.innerHTML += `<br>‚ùå Backend erro: ${response.status} - ${result.error || result.message}`;
                }

            } catch (err) {
                supabaseResult.innerHTML += `<br>‚ùå Backend erro: ${err.message}`;
            }
        }

        async function testFrontendLogin() {
            try {
                frontendResult.innerHTML = 'üîÑ Testando login via frontend React...';
                
                // Simular chamada do frontend
                const response = await fetch('http://127.0.0.1:8080/login', {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                    }
                });

                if (response.ok) {
                    frontendResult.innerHTML = '‚úÖ Frontend carregando! Verifique console do DevTools.';
                } else {
                    frontendResult.innerHTML = `‚ùå Frontend erro: ${response.status}`;
                }

            } catch (err) {
                frontendResult.innerHTML = `‚ùå Frontend erro: ${err.message}`;
            }
        }
    </script>
</body>
</html>